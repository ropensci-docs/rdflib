<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="rdflib">
<title>The Data Lake and Schema On Read • rdflib</title>
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/apple-touch-icon.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://docs.ropensci.org/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="The Data Lake and Schema On Read">
<meta property="og:description" content="rdflib">
<meta property="og:image" content="https://docs.ropensci.org/rdflib/logo.svg">
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Matomo --><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css">
<script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false"></script><script src="https://ropensci.org/scripts/matomo.js"></script><noscript><p><img src="https://ropensci.matomo.cloud/matomo.php?idsite=1&amp;rec=1" style="border:0;" alt=""></p></noscript>
<!-- End Matomo Code -->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    <a href="https://ropensci.org" class="external-link"><img src="https://ropensci.org/img/icon_short_white.svg" id="hexlogo" alt="rOpenSci"></a>
    <a class="navbar-brand me-2" href="../index.html">rdflib</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.2.8</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"></ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/data-lake.html">The Data Lake and Schema On Read</a>
    <a class="dropdown-item" href="../articles/storage.html">Working with Database Storage Backends in `rdflib`</a>
    <a class="dropdown-item" href="../articles/rdf_intro.html">A tidyverse lover's intro to RDF</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ropensci/rdflib/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>The Data Lake and Schema On Read</h1>
                        <h4 data-toc-skip class="author">Carl Boettiger</h4>
            
            <h4 data-toc-skip class="date">2020-01-09</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci/rdflib/blob/HEAD/vignettes/articles/data-lake.Rmd" class="external-link"><code>vignettes/articles/data-lake.Rmd</code></a></small>
      <div class="d-none name"><code>data-lake.Rmd</code></div>
    </div>

    
    
<p>A provocative recent analogy (e.g. <a href="https://www.w3.org/blog/2017/04/dive-into-the-semantic-data-lake/" class="external-link">Archer, 2017</a>) for thinking about RDF is that of the Data Lake. Whereas adding new data to a traditional relational database frequently involves laborious wrangling into the an existing rigid data <em>schema</em> of tables and columns, RDF can enable a far more simple approach of just ‘tossing everything into the data lake.’ While this may sound like a recipe for a terrible mess down the road, RDF gives the promise of <em>schema-on-read</em>: rather than dictating the shape of your data when first adding it to the database (i.e. schema-on-write), a SPARQL query auto-magically reaches into the lake and retrieves all the relevant data, returning it in exactly the schema you ask for; that is, as a nice single table containing only the requested columns.</p>
<p>This can serve as a very effective means of data integration (provided a reasonably consistent and diligent use of URIs in identifying subjects and properties (predicates)), since just about any data can be added to the lake without worrying about whether it comes in a schema that matches the existing architecture of the database. It is this flexibility not to have to define your database schema at the start that is the primary strength of the RDF approach.</p>
<p>A key advantage of this approach is that it is equally as easy to extract your desired data.frame from non-rectangular data as it is from tables or relational database systems. While the previous vignette focused on simple examples including data from single <code>data.frames</code> or small JSON files, this vignette showcases the Data Lake approach on a more complex relational database organized over several tables (<code>nyflights13</code> data, used to teach <code>joins</code> and other relational data in <a href="http://r4ds.had.co.nz" class="external-link">Grolemund &amp; Wickham, 2017</a>), and also in a large non-tabular file returned from the GitHub API (e.g. as used in <a href="https://dcl-2017-04.github.io/curriculum/rectangling.html" class="external-link">Bryan &amp; Wickham, 2017</a> to teach data rectangling.)</p>
<p>Load the necessary libraries to get started:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Data </span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hadley/nycflights13" class="external-link">nycflights13</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://jennybc.github.io/repurrrsive/" class="external-link">repurrrsive</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in library(repurrrsive): there is no package called 'repurrrsive'</span></span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## for comparison approaches</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://jeroen.r-universe.dev/jsonlite" class="external-link">jsonlite</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Our focal package:</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/rdflib/">rdflib</a></span><span class="op">)</span></span>
<span><span class="co">## experimental functions for rdflib package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"examples/tidy_schema.R"</span>, package<span class="op">=</span><span class="st">"rdflib"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Configure RDF storage to use the BDB backend for on-disk storage.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rdf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rdf.html">rdf</a></span><span class="op">(</span>storage <span class="op">=</span> <span class="st">"BDB"</span>, new_db <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="relational-data">Relational data<a class="anchor" aria-label="anchor" href="#relational-data"></a>
</h2>
<div class="section level3">
<h3 id="the-tidyverse-approach">The <code>tidyverse</code> approach<a class="anchor" aria-label="anchor" href="#the-tidyverse-approach"></a>
</h3>
<p><code>tidyverse</code> operations are incredibly effective for working with relational data. These <code>dplyr</code> on the <code>nyflights13</code> dataset are easy to write and fast to execute:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">flights</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">airlines</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">planes</span>, by<span class="op">=</span><span class="st">"tailnum"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">carrier</span>, <span class="va">name</span>, <span class="va">manufacturer</span>, <span class="va">model</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## # A tibble: 6 x 4</span></span>
<span><span class="co">##   carrier name                   manufacturer     model    </span></span>
<span><span class="co">##   &lt;chr&gt;   &lt;chr&gt;                  &lt;chr&gt;            &lt;chr&gt;    </span></span>
<span><span class="co">## 1 UA      United Air Lines Inc.  BOEING           737-824  </span></span>
<span><span class="co">## 2 AA      American Airlines Inc. BOEING           757-223  </span></span>
<span><span class="co">## 3 B6      JetBlue Airways        AIRBUS           A320-232 </span></span>
<span><span class="co">## 4 DL      Delta Air Lines Inc.   BOEING           757-232  </span></span>
<span><span class="co">## 5 UA      United Air Lines Inc.  BOEING           737-924ER</span></span>
<span><span class="co">## 6 B6      JetBlue Airways        AIRBUS INDUSTRIE A320-232</span></span></code></pre>
<p>Still, joins are often a challenge in data preparation. Tabular formats can often be sloppy about what is a key column and what is a literal value, and also whether a column with the same name in different tables means the same thing in both. Both of these things pose challenges for later use when joining data. RDF representation encourages greater discipline through the use of URIs (though we’ll run a bit roughshod over that with the caviler use of <code>x:</code> here.)</p>
<p>This example uses only data that is already part of the relational database. Adding additional information to the database is frequently more tricky, and can result in a rapidly expanding number of tables that can become difficult to work across.</p>
</div>
<div class="section level3">
<h3 id="rdf-approach">RDF approach<a class="anchor" aria-label="anchor" href="#rdf-approach"></a>
</h3>
<p>Okay, now let’s dump the <code>nyflights13</code> into the data lake. Foreign keys in any table must be represented as URIs and not literal strings:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">uri_flights</span> <span class="op">&lt;-</span> <span class="va">flights</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>tailnum <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"planes:"</span>, <span class="va">tailnum</span><span class="op">)</span>,</span>
<span>         carrier <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"airlines:"</span>, <span class="va">carrier</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We write the <code>data.frame</code>s out as nquads. Recall that each cell of a <code>data.frame</code> can be represented as a triple, in which the column is the predicate, the primary key (or row number) the subject, and the cell value the object. We turn column names and primary keys into URIs using a prefix based on the table name. (Note that <code>rdflib</code> does this conversion by merely munging cells and calling <code>write.table</code>, it is not a standard <code>redland</code> library transform).</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/write_nquads.html">write_nquads</a></span><span class="op">(</span><span class="va">airlines</span>,  <span class="st">"airlines.nq"</span>, key <span class="op">=</span> <span class="st">"carrier"</span>, prefix <span class="op">=</span> <span class="st">"airlines:"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="../reference/write_nquads.html">write_nquads</a></span><span class="op">(</span><span class="va">planes</span>,  <span class="st">"planes.nq"</span>, key <span class="op">=</span> <span class="st">"tailnum"</span>, prefix <span class="op">=</span> <span class="st">"planes:"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="../reference/write_nquads.html">write_nquads</a></span><span class="op">(</span><span class="va">uri_flights</span>,  <span class="st">"flights.nq"</span>, prefix <span class="op">=</span> <span class="st">"flights:"</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    user  system elapsed </span></span>
<span><span class="co">##  16.807   2.561  19.128</span></span></code></pre>
<p>We can now read these into our RDF data lake:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/read_nquads.html">read_nquads</a></span><span class="op">(</span><span class="st">"airlines.nq"</span>, rdf <span class="op">=</span> <span class="va">rdf</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="../reference/read_nquads.html">read_nquads</a></span><span class="op">(</span><span class="st">"flights.nq"</span>, rdf <span class="op">=</span> <span class="va">rdf</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="../reference/read_nquads.html">read_nquads</a></span><span class="op">(</span><span class="st">"planes.nq"</span>, rdf <span class="op">=</span> <span class="va">rdf</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    user  system elapsed </span></span>
<span><span class="co">##  79.267  51.865  70.052</span></span></code></pre>
<p>Note that flights does not have a natural key (somewhat surprisingly, <code>flight</code> number is not a unique key for this table, as the same flight number is reused on the same route at different times.) So, we will treat each row as a unique anonymous key by setting the key to <code>NULL</code>.</p>
</div>
<div class="section level3">
<h3 id="schema-on-read">Schema on read<a class="anchor" aria-label="anchor" href="#schema-on-read"></a>
</h3>
<p>We simply define the columns we want and we immediately get back the desired <code>data.frame</code>:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s</span> <span class="op">&lt;-</span> </span>
<span>  <span class="st">'SELECT  ?carrier ?name ?manufacturer ?model ?dep_delay</span></span>
<span><span class="st">WHERE {</span></span>
<span><span class="st">?flight &lt;flights:tailnum&gt;  ?tailnum .</span></span>
<span><span class="st">?flight &lt;flights:carrier&gt;  ?carrier .</span></span>
<span><span class="st">?flight &lt;flights:dep_delay&gt;  ?dep_delay .</span></span>
<span><span class="st">?tailnum &lt;planes:manufacturer&gt; ?manufacturer .</span></span>
<span><span class="st">?tailnum &lt;planes:model&gt; ?model .</span></span>
<span><span class="st">?carrier &lt;airlines:name&gt; ?name</span></span>
<span><span class="st">}'</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rdf_query.html">rdf_query</a></span><span class="op">(</span><span class="va">rdf</span>, <span class="va">s</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    user  system elapsed </span></span>
<span><span class="co">##  16.078   1.164  13.734</span></span></code></pre>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## # A tibble: 6 x 5</span></span>
<span><span class="co">##   carrier     name                   manufacturer model     dep_delay</span></span>
<span><span class="co">##   &lt;chr&gt;       &lt;chr&gt;                  &lt;chr&gt;        &lt;chr&gt;     &lt;chr&gt;    </span></span>
<span><span class="co">## 1 airlines:UA United Air Lines Inc.  BOEING       737-824   2        </span></span>
<span><span class="co">## 2 airlines:UA United Air Lines Inc.  BOEING       737-824   4        </span></span>
<span><span class="co">## 3 airlines:AA American Airlines Inc. BOEING       757-223   2        </span></span>
<span><span class="co">## 4 airlines:B6 JetBlue Airways        AIRBUS       A320-232  -1       </span></span>
<span><span class="co">## 5 airlines:DL Delta Air Lines Inc.   BOEING       757-232   -6       </span></span>
<span><span class="co">## 6 airlines:UA United Air Lines Inc.  BOEING       737-924ER -4</span></span></code></pre>
<p>Note that in place of joins, we give more semantically meaningful statements about the data: e.g. <code>manufacturer</code> is a property of a <code>tailnum</code> (corresponding to a particular physical aircraft), not of a <code>flight</code> number. Departure delay <code>dep_delay</code> is a property of a flight, not of an aircraft (<code>tailnum</code>).</p>
<p>This is reminiscent of the way in which these data are organized in the relational database tables to begin with: we find <code>deb_delay</code> in the <code>flights</code> table and <code>manufacturer</code> in the <code>planes</code> table. Good relational design encourages this, but to work with the data the user is often left having to do the required joins, which also creates tables where these semantics are less clear.</p>
</div>
</div>
<div class="section level2">
<h2 id="non-tabular-data">Non-tabular data<a class="anchor" aria-label="anchor" href="#non-tabular-data"></a>
</h2>
<div class="section level3">
<h3 id="the-tidyverse-approach-1">The <code>tidyverse</code> approach<a class="anchor" aria-label="anchor" href="#the-tidyverse-approach-1"></a>
</h3>
<p>We start with data from <a href="https://dcl-2017-04.github.io/curriculum/rectangling.html" class="external-link">Bryan &amp; Wickham, 2017</a> lesson on data rectangling:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/gh_repos.json"</span>, package<span class="op">=</span><span class="st">"repurrrsive"</span><span class="op">)</span></span>
<span><span class="va">gh_data</span> <span class="op">&lt;-</span> <span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/jsonlite/man/read_json.html" class="external-link">read_json</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in readBin(structure(4L, class = c("file", "connection"), conn_id = &lt;pointer: 0x263&gt;), : can only read from a binary connection</span></span></code></pre>
<p>The original lesson illustrates the power and reasonably concise syntax of the <code>tidyverse</code> package, <code>purrr</code>, to iterate over this complex structure to extract the necessary data. In this approach, nesting of the data is largely a nuisance to overcome rather than an asset to the data analyst:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gh_flat</span> <span class="op">&lt;-</span> <span class="va">gh_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu">flatten</span><span class="op">(</span><span class="op">)</span>  <span class="co"># abandon nested structure and hope we didn't need it</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in eval(lhs, parent, parent): object 'gh_data' not found</span></span></code></pre>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gh_tibble</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span>     <span class="va">gh_flat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_chr</a></span><span class="op">(</span><span class="st">"name"</span><span class="op">)</span>,</span>
<span>  issues <span class="op">=</span>   <span class="va">gh_flat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_int</a></span><span class="op">(</span><span class="st">"open_issues_count"</span><span class="op">)</span>,</span>
<span>  wiki <span class="op">=</span>     <span class="va">gh_flat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_lgl</a></span><span class="op">(</span><span class="st">"has_wiki"</span><span class="op">)</span>,</span>
<span>  homepage <span class="op">=</span> <span class="va">gh_flat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_chr</a></span><span class="op">(</span><span class="st">"homepage"</span>, .default <span class="op">=</span> <span class="st">""</span><span class="op">)</span>,</span>
<span>  owner <span class="op">=</span>    <span class="va">gh_flat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_chr</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"owner"</span>, <span class="st">"login"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in eval(lhs, parent, parent): object 'gh_flat' not found</span></span></code></pre>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gh_tibble</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">name</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in eval(lhs, parent, parent): object 'gh_tibble' not found</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="rdf-on-non-tabular-data">RDF on non-tabular data<a class="anchor" aria-label="anchor" href="#rdf-on-non-tabular-data"></a>
</h3>
<p>The RDF approach merely treats JSON as JSON-LD within a given vocabulary. In this context, nesting implicitly provides important semantic information about relationships between the data, which are captured in the RDF triples. Here, we import the JSON data as RDF (and add it to our existing triplestore just for fun)</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gh_rdf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as_rdf.html">as_rdf</a></span><span class="op">(</span><span class="va">gh_data</span>, rdf <span class="op">=</span> <span class="va">rdf</span>, prefix <span class="op">=</span> <span class="st">"gh:"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in as_rdf(gh_data, rdf = rdf, prefix = "gh:"): object 'gh_data' not found</span></span></code></pre>
<p>And we can query it back out of the lake just by selecting the columns of interest.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s</span> <span class="op">&lt;-</span> </span>
<span>  <span class="st">'SELECT ?name ?issues ?wiki ?homepage ?owner</span></span>
<span><span class="st">WHERE {</span></span>
<span><span class="st">?repo &lt;gh:homepage&gt;  ?homepage .</span></span>
<span><span class="st">?repo &lt;gh:has_wiki&gt; ?wiki .</span></span>
<span><span class="st">?repo &lt;gh:open_issues_count&gt; ?issues .</span></span>
<span><span class="st">?repo &lt;gh:name&gt; ?name .</span></span>
<span><span class="st">?repo &lt;gh:owner&gt; ?owner_id .</span></span>
<span><span class="st">?owner_id &lt;gh:login&gt;  ?owner </span></span>
<span><span class="st">}'</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span></span>
<span><span class="va">rdf_tibble</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rdf_query.html">rdf_query</a></span><span class="op">(</span><span class="va">rdf</span>, <span class="va">s</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    user  system elapsed </span></span>
<span><span class="co">##   7.992   0.287   8.279</span></span></code></pre>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">rdf_tibble</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## # A tibble: 0 x 5</span></span>
<span><span class="co">## # … with 5 variables: name &lt;chr&gt;, issues &lt;chr&gt;, wiki &lt;chr&gt;, homepage &lt;chr&gt;, owner &lt;chr&gt;</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="going-further-a-dplyr-style-syntax-for-sparql">Going further: A <code>dplyr</code>-style syntax for SPARQL?<a class="anchor" aria-label="anchor" href="#going-further-a-dplyr-style-syntax-for-sparql"></a>
</h3>
<p><code>dplyr</code> provides a reasonably intuitive, powerful, and concise interface for many common SQL commands. Indeed, <code>dplyr</code> function calls are literally serialized to the corresponding SQL query when working with a relational database back-end (via <code>dbplyr</code>). Can a similar API be developed for SPARQL queries?</p>
<p>SPARQL syntax is obviously inspired by SQL syntax, and includes many of the same operations found in SQL and <code>dplyr</code> (e.g. SELECT, WHERE, FILTER, DISTINCT) as well as other more RDF specific queries.</p>
<p>If we are willing to make some assumptions about the most common queries, we can start to make some simplifying functions. For instance, in the above patterns, the variables being returned are always objects from the triples, with columns being named using the corresponding predicate. Assuming some additional convention to define the prefixes and indicate graph traversal (i.e. nested values), we could have constructed the above query from a call:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy_schema</span>(name, open_issues_count, has_wiki, homepage owner.login)</span></code></pre></div>
<p>Though to generalize to arbitrary labels and predicates this might need to support something like:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">tidy_schema</span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"gh:name"</span>, </span>
<span>                        issues <span class="op">=</span> <span class="st">"gh:open_issues_count"</span>, </span>
<span>                        wiki <span class="op">=</span> <span class="st">"gh:has_wiki"</span>, </span>
<span>                        homepage <span class="op">=</span> <span class="st">"gh:homepage"</span>,</span>
<span>                        owner <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"gh:owner"</span>, login <span class="op">=</span> <span class="st">"gh:login"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><!-- begin footer --><div class="footer">
    <div class="container">
        <div class="row start top-4 bottom-8">
            <div class="col-2"> <img id="footerlogo" src="https://ropensci.org/img/icon_short_white.svg">
</div>
            <div class="col-10">
                <div class="row">
                    <div class="col-md-4 col-xs-6">
                        <a href="https://github.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-github"></div></a>
                        <a href="https://github.com/ropenscilabs" target="_blank" class="external-link"><div class="icon fa fa-flask"></div></a>
                        <a href="https://hachyderm.io/@ropensci" target="_blank" class="external-link"><div class="icon fab fa-mastodon"></div></a>
                        <a href="https://vimeo.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-vimeo"></div></a>
                    </div>
                </div>
                <div class="row top-4">
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">About</h5>
                            <li><a href="https://ropensci.org/about" class="external-link">About rOpenSci</a></li>
                            <li><a href="https://ropensci.org/software-review" class="external-link">Software Review</a></li>
                            <li><a href="https://ropensci.org/about#team" class="external-link">Our Team</a></li>
                            <li><a href="https://ropensci.org/careers" class="external-link">Jobs</a></li>
                            <li><a href="https://ropensci.org/donate" class="external-link">Donate</a></li>
                            <li><a href="https://ropensci.org/contact" class="external-link">Contact Us</a></li>
                        </ul>
</div>
                    <div class="col-md-3 col-sm-4">
                        <ul>
<h5 class="bottom-2">Community</h5>
                            <li><a href="https://ropensci.org/community/" class="external-link">Our Community</a></li>
                            <li><a href="https://ropensci.org/commcalls/" class="external-link">Community calls</a></li>
                            <li><a href="https://ropensci.org/events/" class="external-link">Events</a></li>
                            <li><a href="https://discuss.ropensci.org/" class="external-link">Join the Discussion</a></li>
                            <li><a href="https://ropensci.org/code-of-conduct" class="external-link">Code of conduct</a></li>
                        </ul>
</div>
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">Resources</h5>
                            <li><a href="https://ropensci.org/packages/" class="external-link">Packages</a></li>
                            <li><a href="https://ropensci.org/usecases/" class="external-link">Use Cases</a></li>
                            <li><a href="https://ropensci.org/talks-papers/" class="external-link">Talks &amp; Publications</a></li>
                            <li><a href="https://docs.ropensci.org/" class="external-link">Documentation</a></li>
                            <li><a href="https://ropensci.org/news/" class="external-link">Newsletter</a></li>
                            <li><a href="https://ropensci.org/how-to-cite-ropensci/" class="external-link">Cite rOpenSci</a></li>
                        </ul>
</div>
                    <div class="col-md-4 col-xs-12">
                        <h5 class="bottom-2"></h5>

                        <p>rOpenSci is a fiscally sponsored project of <a href="http://numfocus.org" class="external-link">NumFOCUS</a>.</p>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- / end footer -->


    </footer>
</div>

  

  

  </body>
</html>
