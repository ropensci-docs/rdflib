<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="rdflib">
<title>Working with Database Storage Backends in `rdflib` • rdflib</title>
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/apple-touch-icon.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://docs.ropensci.org/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Working with Database Storage Backends in `rdflib`">
<meta property="og:description" content="rdflib">
<meta property="og:image" content="https://docs.ropensci.org/rdflib/logo.svg">
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Matomo --><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css">
<script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false"></script><script src="https://ropensci.org/scripts/matomo.js"></script><noscript><p><img src="https://ropensci.matomo.cloud/matomo.php?idsite=1&amp;rec=1" style="border:0;" alt=""></p></noscript>
<!-- End Matomo Code -->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    <a href="https://ropensci.org" class="external-link"><img src="https://ropensci.org/img/icon_short_white.svg" id="hexlogo" alt="rOpenSci"></a>
    <a class="navbar-brand me-2" href="../index.html">rdflib</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.2.8</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"></ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/data-lake.html">The Data Lake and Schema On Read</a>
    <a class="dropdown-item" href="../articles/storage.html">Working with Database Storage Backends in `rdflib`</a>
    <a class="dropdown-item" href="../articles/rdf_intro.html">A tidyverse lover's intro to RDF</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ropensci/rdflib/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Working with Database Storage Backends in `rdflib`</h1>
                        <h4 data-toc-skip class="author">Carl Boettiger</h4>
            
            <h4 data-toc-skip class="date">2020-01-09</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci/rdflib/blob/HEAD/vignettes/articles/storage.Rmd" class="external-link"><code>vignettes/articles/storage.Rmd</code></a></small>
      <div class="d-none name"><code>storage.Rmd</code></div>
    </div>

    
    
<p>By default, <code>rdflib</code> stores triples in memory, which can be read in from and written out to files on disk using a variety of serializations (<code>rdfxml</code>, <code>json-ld</code>, <code>ntriples</code>, <code>nquads</code> or <code>turtle</code>). This is analgous to reading in a <code>data.frame</code> object from a <code>csv</code>, <code>tsv</code>, or other text-delimited file, which requires the full data object to be read into memory before a user can manipulate it. This approach runs into limitations with very large datasets, which may exceed the memory available. Just as R packages such as <code>dplyr</code> offer the ability to perform manipulations with very large data through a connection to a database backend such as SQLite, MySQL or PostgreSQL, <code>rdflib</code> can rely on these and other databases to provide a disk-based backend.</p>
<div class="section level4">
<h4 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h4>
<p>Unfortunately, at this time, support for these storage devices is not included in the prebuild Mac and Windows binaries of the <code>redland</code> R package. Users wanting to take advantage of disk-based storage must instead build and install the <code>redland</code> R package from source; and in some cases, also build the <code>redland</code> C libraries from source. This package provides a <a href="https://github.com/ropensci/rdflib/blob/master/inst/docker/Dockerfile" class="external-link">Dockerfile</a> containing a portable recipe for building the library with support for the 5 main backend storage devices: SQLite, MySQL, PostgreSQL, Virtuoso, and Berkeley DB. This vignette documents the installation and use of these devices.</p>
<p>Also see the <a href="http://librdf.org/docs/api/redland-storage-modules.html" class="external-link">official documentation</a> for the redland C library discussing all supported storage devices.</p>
</div>
<div class="section level2">
<h2 id="benchmarks">Benchmarks<a class="anchor" aria-label="anchor" href="#benchmarks"></a>
</h2>
<p>Here we show examples of reading in a modest set of 190,000 triples from an <code>nquads</code> file and executing a simple SPARQL query using each the five backends supported by <code>rdflib</code>. First we load the libraries and prepare an example file by triple-ifying 10,000 rows of the <code>flights</code> data.frame:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/rdflib/">rdflib</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hadley/nycflights13" class="external-link">nycflights13</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">example</span> <span class="op">&lt;-</span> <span class="va">flights</span><span class="op">[</span><span class="fl">1e4</span>,<span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span></span>
<span><span class="fu"><a href="../reference/write_nquads.html">write_nquads</a></span><span class="op">(</span><span class="va">example</span>, <span class="st">"example.nq"</span>, prefix <span class="op">=</span> <span class="st">"flights"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;   0.009   0.001   0.008</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span></span>
<span><span class="fu"><a href="../reference/write_nquads.html">write_nquads</a></span><span class="op">(</span><span class="va">flights</span>, <span class="st">"flights.nq"</span>, prefix <span class="op">=</span> <span class="st">"flights"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;  15.107   0.474  15.632</span></span></code></pre></div>
<div class="section level3">
<h3 id="in-memory">In Memory<a class="anchor" aria-label="anchor" href="#in-memory"></a>
</h3>
<p>Because the dataset is small enough to easily fit in memory, the default in-memory option is an obvious choice with excellent performance. Note that this option will not be possible with larger triplestores (e.g. with millions or more triples). Our testing has found that even on machines with 100GB+ of RAM, the redland in-memory backend is not able to take advantage of that additional memory and disk-based backends are required.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">triplestore</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rdf.html">rdf</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/read_nquads.html">read_nquads</a></span><span class="op">(</span><span class="st">"example.nq"</span>, rdf <span class="op">=</span> <span class="va">triplestore</span><span class="op">)</span> <span class="co"># smaller set</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;   0.002   0.000   0.002</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">query</span> <span class="op">&lt;-</span> </span>
<span>  <span class="st">'SELECT  ?carrier ?flight ?origin ?dep_delay</span></span>
<span><span class="st">WHERE {</span></span>
<span><span class="st">?flight &lt;flights:carrier&gt;  ?carrier .</span></span>
<span><span class="st">?flight &lt;flights:dep_delay&gt;  ?dep_delay .</span></span>
<span><span class="st">?flight &lt;flights:origin&gt; ?origin</span></span>
<span><span class="st">}'</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rdf_query.html">rdf_query</a></span><span class="op">(</span><span class="va">triplestore</span>, <span class="va">query</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;   0.011   0.008   0.019</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/rdf_free.html">rdf_free</a></span><span class="op">(</span><span class="va">triplestore</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="bdb">BDB<a class="anchor" aria-label="anchor" href="#bdb"></a>
</h3>
<p>The <a href="https://en.wikipedia.org/wiki/Berkeley_DB" class="external-link">Berkeley DB</a> is a simple key-value store</p>
<blockquote>
<p>It is the most mature and primary persistent store and suitable for large models, tested in the 2-3 million range.</p>
</blockquote>
<p>Berkeley DB is a simple disk-based storage option. Install both the redland libraries and the berkeley-db (e.g. <code>bd-dev</code> on Debian/Ubuntu) libraries, and then install <code>redland</code> from source. BDB is relatively fast for data too large for memory.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">triplestore</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rdf.html">rdf</a></span><span class="op">(</span>storage<span class="op">=</span><span class="st">"BDB"</span>, new_db <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/read_nquads.html">read_nquads</a></span><span class="op">(</span><span class="st">"flights.nq"</span>, rdf <span class="op">=</span> <span class="va">triplestore</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;  55.985  15.686  71.787</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rdf_query.html">rdf_query</a></span><span class="op">(</span><span class="va">triplestore</span>, <span class="va">query</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;  15.001   0.216  15.222</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/rdf_free.html">rdf_free</a></span><span class="op">(</span><span class="va">triplestore</span><span class="op">)</span></span>
<span><span class="co">## Becuase BDB is just a hash table, redland needs three separate files:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unlink.html" class="external-link">unlink</a></span><span class="op">(</span><span class="st">"rdflib-po2s.db"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unlink.html" class="external-link">unlink</a></span><span class="op">(</span><span class="st">"rdflib-so2p.db"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unlink.html" class="external-link">unlink</a></span><span class="op">(</span><span class="st">"rdflib-sp2o.db"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="virtuoso">Virtuoso<a class="anchor" aria-label="anchor" href="#virtuoso"></a>
</h3>
<p>Unlike the other backends which use general purpose relational databases or key-value stores, <a href="https://en.wikipedia.org/wiki/Virtuoso_Universal_Server" class="external-link">Virtuoso</a> dedicated to RDF-based data. Virtuoso is a popular open source database for RDF with a rich set of built-in interfaces and features, but we can also interact with it directly through the <code>redland</code> bindings just like we do any other backend in <code>rdflib</code>. Virtuoso setup may be slightly more involved for individuals unfamiliar with it, but will probably provide the best performance in the case of very large triplestores. The example below shows a new database setup, but <code>rdflib</code> can also connect to any existing Virtuoso database.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">triplestore</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rdf.html">rdf</a></span><span class="op">(</span>storage <span class="op">=</span> <span class="st">"virtuoso"</span>, </span>
<span>                   user <span class="op">=</span> <span class="st">"dba"</span>, </span>
<span>                   password <span class="op">=</span> <span class="st">"dba"</span>, </span>
<span>                   dsn <span class="op">=</span> <span class="st">"Local Virtuoso"</span></span>
<span>                   <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/read_nquads.html">read_nquads</a></span><span class="op">(</span><span class="st">"flights.nq"</span>, rdf <span class="op">=</span> <span class="va">triplestore</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;     user   system  elapsed </span></span>
<span><span class="co">#&gt;  111.500   84.856 3336.717</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rdf_query.html">rdf_query</a></span><span class="op">(</span><span class="va">triplestore</span>, <span class="va">query</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;  17.899   9.056 133.143</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rdf_query.html">rdf_query</a></span><span class="op">(</span><span class="va">triplestore</span>, <span class="st">"SELECT ?s ?p ?o WHERE{ ?s ?p ?o }"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: 1391187 parsing failures.</span></span>
<span><span class="co">#&gt;     row col expected     actual         file</span></span>
<span><span class="co">#&gt; 1338850   o a double _:r1011167 literal data</span></span>
<span><span class="co">#&gt; 1338851   o a double _:r1011168 literal data</span></span>
<span><span class="co">#&gt; 1338852   o a double _:r1011169 literal data</span></span>
<span><span class="co">#&gt; 1338853   o a double _:r1011170 literal data</span></span>
<span><span class="co">#&gt; 1338854   o a double _:r1012106 literal data</span></span>
<span><span class="co">#&gt; ....... ... ........ .......... ............</span></span>
<span><span class="co">#&gt; See problems(...) for more details.</span></span>
<span><span class="va">df</span></span>
<span><span class="co">#&gt; # A tibble: 6,398,744 x 3</span></span>
<span><span class="co">#&gt;    s          p                o</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;      &lt;chr&gt;        &lt;dbl&gt;</span></span>
<span><span class="co">#&gt;  1 flights:1  flights:year  2013</span></span>
<span><span class="co">#&gt;  2 flights:2  flights:year  2013</span></span>
<span><span class="co">#&gt;  3 flights:3  flights:year  2013</span></span>
<span><span class="co">#&gt;  4 flights:4  flights:year  2013</span></span>
<span><span class="co">#&gt;  5 flights:5  flights:year  2013</span></span>
<span><span class="co">#&gt;  6 flights:6  flights:year  2013</span></span>
<span><span class="co">#&gt;  7 flights:7  flights:year  2013</span></span>
<span><span class="co">#&gt;  8 flights:8  flights:year  2013</span></span>
<span><span class="co">#&gt;  9 flights:9  flights:year  2013</span></span>
<span><span class="co">#&gt; 10 flights:10 flights:year  2013</span></span>
<span><span class="co">#&gt; # … with 6,398,734 more rows</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/rdf_free.html">rdf_free</a></span><span class="op">(</span><span class="va">triplestore</span><span class="op">)</span></span></code></pre></div>
<p>Or on remote virtuoso:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">triplestore</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rdf.html">rdf</a></span><span class="op">(</span>storage <span class="op">=</span> <span class="st">"virtuoso"</span>, </span>
<span>                   user <span class="op">=</span> <span class="st">"dba"</span>, </span>
<span>                   password <span class="op">=</span> <span class="st">"dba"</span>, </span>
<span>                   host <span class="op">=</span> <span class="st">"virtuoso:1111"</span></span>
<span>                   <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/read_nquads.html">read_nquads</a></span><span class="op">(</span><span class="st">"flights.nq"</span>, rdf <span class="op">=</span> <span class="va">triplestore</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;       user     system    elapsed </span></span>
<span><span class="co">#&gt; 129710.695   2036.842 149941.651</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="postgres">POSTGRES<a class="anchor" aria-label="anchor" href="#postgres"></a>
</h3>
<p>Postgres and MySQL are ubiquitious relational databases. This backend requires the <code>redland</code> binaries are built from source with this support enabled, which is not the case for pre-built Mac or Linux binaries.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">triplestore</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rdf.html">rdf</a></span><span class="op">(</span>storage <span class="op">=</span> <span class="st">"postgres"</span>, </span>
<span>                   host <span class="op">=</span> <span class="st">"postgres"</span>, </span>
<span>                   user <span class="op">=</span> <span class="st">"postgres"</span>, </span>
<span>                   password <span class="op">=</span> <span class="st">"rdflib"</span>, </span>
<span>                   new_db <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in rdf_storage(storage, world, host, port, user, password,</span></span>
<span><span class="co">#&gt; database, : postgres driver not found. Falling back on in-memory storage</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/read_nquads.html">read_nquads</a></span><span class="op">(</span><span class="st">"flights.nq"</span>, rdf <span class="op">=</span> <span class="va">triplestore</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;  31.803  20.715  52.586</span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rdf_query.html">rdf_query</a></span><span class="op">(</span><span class="va">triplestore</span>, <span class="va">query</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;   5.449   0.032   5.483</span></span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/rdf_free.html">rdf_free</a></span><span class="op">(</span><span class="va">triplestore</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="mysql">MySQL<a class="anchor" aria-label="anchor" href="#mysql"></a>
</h3>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">triplestore</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rdf.html">rdf</a></span><span class="op">(</span>storage <span class="op">=</span> <span class="st">"mysql"</span>, </span>
<span>                   host <span class="op">=</span> <span class="st">"mariadb"</span>, </span>
<span>                   user <span class="op">=</span> <span class="st">"root"</span>, </span>
<span>                   password <span class="op">=</span> <span class="st">"rdflib"</span>, </span>
<span>                   database <span class="op">=</span> <span class="st">"mysql"</span>,</span>
<span>                   new_db <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>                  <span class="op">)</span></span>
<span><span class="co">#&gt; Warning in rdf_storage(storage, world, host, port, user, password,</span></span>
<span><span class="co">#&gt; database, : mysql driver not found. Falling back on in-memory storage</span></span>
<span>  <span class="fu"><a href="../reference/read_nquads.html">read_nquads</a></span><span class="op">(</span><span class="st">"flights.nq"</span>, rdf <span class="op">=</span> <span class="va">triplestore</span><span class="op">)</span></span>
<span><span class="co">#&gt; Total of 1996496 triples, stored in hashes</span></span>
<span><span class="co">#&gt; -------------------------------</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt;  (preview supressed for performance)</span></span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rdf_query.html">rdf_query</a></span><span class="op">(</span><span class="va">triplestore</span>, <span class="va">query</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;   5.510   0.004   5.515</span></span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/rdf_free.html">rdf_free</a></span><span class="op">(</span><span class="va">triplestore</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="sqlite">SQLite<a class="anchor" aria-label="anchor" href="#sqlite"></a>
</h3>
<p><a href="https://en.wikipedia.org/wiki/SQLite" class="external-link">SQLite</a> is relatively easy to set up, but appears to have rather poor overall performance. Requires SQLite development libraries installed (should work ‘out-of-the-box’ with Mac binaries for <code>redland</code> package).</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">triplestore</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rdf.html">rdf</a></span><span class="op">(</span>storage<span class="op">=</span><span class="st">"sqlite"</span>, new_db <span class="op">=</span> <span class="cn">TRUE</span>, name<span class="op">=</span><span class="st">"rdflib.sqlite"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in rdf_storage(storage, world, host, port, user, password,</span></span>
<span><span class="co">#&gt; database, : sqlite driver not found. Falling back on in-memory storage</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/read_nquads.html">read_nquads</a></span><span class="op">(</span><span class="st">"flights.nq"</span>, rdf <span class="op">=</span> <span class="va">triplestore</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;  31.607  20.219  51.857</span></span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rdf_query.html">rdf_query</a></span><span class="op">(</span><span class="va">triplestore</span>, <span class="va">query</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;   5.559   0.028   5.588</span></span></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/rdf_free.html">rdf_free</a></span><span class="op">(</span><span class="va">triplestore</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="building-redland-with-full-backend-support">Building redland with full backend support<a class="anchor" aria-label="anchor" href="#building-redland-with-full-backend-support"></a>
</h2>
<p>Getting full support for the above backend databases through the <code>redland</code> R package is not trivial. The <code>redland</code> R package provides bindings to the redland libraries. Unfortunately, commonly available binary versions of those libraries, such as <code>librdf0-dev</code> on Debian, <code>redland</code> on Mac OSX brew, and the statically linked versions for Mac and Windows shipping in the R package, do not build those libraries with the optional support for all backends. (NOTE: it is the C library itself which must be built from source with these options, not just the R package source). Consequently, users must build <code>librdf</code> from the original sources, <a href="https://github.com/dajobe/librdf" class="external-link uri">https://github.com/dajobe/librdf</a> with all backend linking libraries available, and then also build the <code>redland</code> R package from source, to be able to access all of these backends. On a Debian or Ubuntu system this looks like the following:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="ex">apt-get</span> update <span class="kw">&amp;&amp;</span> <span class="ex">apt-get</span> <span class="at">-yq</span> install <span class="dt">\</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>libxml2-dev <span class="dt">\</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>libcurl4-openssl-dev <span class="dt">\</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>libssl-dev <span class="dt">\</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>git <span class="dt">\</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>automake <span class="dt">\</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>libtool <span class="dt">\</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>gtk-doc-tools <span class="dt">\</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>bison <span class="dt">\</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>flex <span class="dt">\</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>libgmp-dev  <span class="dt">\</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>libmhash-dev <span class="dt">\</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>libgcrypt20-dev <span class="dt">\</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>libpcre3-dev <span class="dt">\</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>libv8-dev <span class="dt">\</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>libjq-dev <span class="dt">\</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>libpq-dev <span class="dt">\</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>libdb-dev <span class="dt">\</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>libsqlite3-dev <span class="dt">\</span></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>libmariadbclient-dev <span class="dt">\</span></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>librdf-storage-virtuoso <span class="dt">\</span></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>virtuoso-server <span class="dt">\</span></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>unixodbc-dev</span></code></pre></div>
<p>Now we can build <code>raptor</code> (parsers), <code>rasqal</code> (sparql queries) and <code>rdflib</code> from source:</p>
<pre><code>git clone git://github.com/dajobe/raptor.git &amp;&amp; \
cd raptor &amp;&amp; \
./autogen.sh &amp;&amp; \
make &amp;&amp; \
make install &amp;&amp; \
cd .. &amp;&amp; \
git clone git://github.com/dajobe/rasqal.git &amp;&amp; \
cd rasqal &amp;&amp; \
./autogen.sh &amp;&amp; \
make &amp;&amp; \
make install &amp;&amp; \
cd .. &amp;&amp; \
git clone git://github.com/dajobe/librdf.git &amp;&amp; \
cd librdf &amp;&amp; \
./autogen.sh &amp;&amp; \
make &amp;&amp; \
make install</code></pre>
<p>A See the <a href="https://github.com/ropensci/rdflib/tree/master/inst/docker/Dockerfile" class="external-link">Dockerfile</a> in <code>inst/docker</code> for an example of this, or simply use the <a href="https://rocker-project.org" class="external-link">Rocker-based</a> image <code>ropensci/rdflib</code>.</p>
</div>
<div class="section level2">
<h2 id="testing">Testing<a class="anchor" aria-label="anchor" href="#testing"></a>
</h2>
<p><code>rdflib</code> uses Circle-CI to test database backends using <code>docker-compose</code>. <code>docker-compose</code> pulls down dedicated docker containers for <code>postgres</code> and <code>mariadb</code>, along with the <code>ropensci/rdflib</code> container, which includes a version of <code>redland</code> compiled with support for all five major backend storage systems. See the <a href="https://github.com/ropensci/rdflib/tree/master/inst/docker/Dockerfile" class="external-link">Dockerfile</a> in <code>inst/docker</code> and associated [docker-compose.yml]((<a href="https://github.com/ropensci/rdflib/tree/master/docker-compose.yml" class="external-link uri">https://github.com/ropensci/rdflib/tree/master/docker-compose.yml</a>) used in testing for an example of this configuration. You can also pull the Docker image <code>ropensci/rdflib</code> from Docker Hub for testing with all these libraries installed.</p>
<p>The badge below (also on the package README) indicates that these dedicated tests are passing.</p>
<p><a href="https://circleci.com/gh/ropensci/rdflib" class="external-link"><img src="https://circleci.com/gh/ropensci/rdflib.svg?style=svg" alt="CircleCI"></a></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><!-- begin footer --><div class="footer">
    <div class="container">
        <div class="row start top-4 bottom-8">
            <div class="col-2"> <img id="footerlogo" src="https://ropensci.org/img/icon_short_white.svg">
</div>
            <div class="col-10">
                <div class="row">
                    <div class="col-md-4 col-xs-6">
                        <a href="https://github.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-github"></div></a>
                        <a href="https://github.com/ropenscilabs" target="_blank" class="external-link"><div class="icon fa fa-flask"></div></a>
                        <a href="https://hachyderm.io/@ropensci" target="_blank" class="external-link"><div class="icon fab fa-mastodon"></div></a>
                        <a href="https://vimeo.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-vimeo"></div></a>
                    </div>
                </div>
                <div class="row top-4">
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">About</h5>
                            <li><a href="https://ropensci.org/about" class="external-link">About rOpenSci</a></li>
                            <li><a href="https://ropensci.org/software-review" class="external-link">Software Review</a></li>
                            <li><a href="https://ropensci.org/about#team" class="external-link">Our Team</a></li>
                            <li><a href="https://ropensci.org/careers" class="external-link">Jobs</a></li>
                            <li><a href="https://ropensci.org/donate" class="external-link">Donate</a></li>
                            <li><a href="https://ropensci.org/contact" class="external-link">Contact Us</a></li>
                        </ul>
</div>
                    <div class="col-md-3 col-sm-4">
                        <ul>
<h5 class="bottom-2">Community</h5>
                            <li><a href="https://ropensci.org/community/" class="external-link">Our Community</a></li>
                            <li><a href="https://ropensci.org/commcalls/" class="external-link">Community calls</a></li>
                            <li><a href="https://ropensci.org/events/" class="external-link">Events</a></li>
                            <li><a href="https://discuss.ropensci.org/" class="external-link">Join the Discussion</a></li>
                            <li><a href="https://ropensci.org/code-of-conduct" class="external-link">Code of conduct</a></li>
                        </ul>
</div>
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">Resources</h5>
                            <li><a href="https://ropensci.org/packages/" class="external-link">Packages</a></li>
                            <li><a href="https://ropensci.org/usecases/" class="external-link">Use Cases</a></li>
                            <li><a href="https://ropensci.org/talks-papers/" class="external-link">Talks &amp; Publications</a></li>
                            <li><a href="https://docs.ropensci.org/" class="external-link">Documentation</a></li>
                            <li><a href="https://ropensci.org/news/" class="external-link">Newsletter</a></li>
                            <li><a href="https://ropensci.org/how-to-cite-ropensci/" class="external-link">Cite rOpenSci</a></li>
                        </ul>
</div>
                    <div class="col-md-4 col-xs-12">
                        <h5 class="bottom-2"></h5>

                        <p>rOpenSci is a fiscally sponsored project of <a href="http://numfocus.org" class="external-link">NumFOCUS</a>.</p>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- / end footer -->


    </footer>
</div>

  

  

  </body>
</html>
